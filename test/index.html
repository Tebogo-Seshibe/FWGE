<!doctype html>

<!-- 
- Author: Tebogo Christopher Seshibe
- Wethinkcode(.co.za)
- Joburg CBD
-->

<html lang="en">
	<head>
		<title> Testing </title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="author" content="Tebogo Christopher Seshibe" />
        <link rel="stylesheet" href="style.css" />
	</head>

	<body>
        <canvas id="canvas"></canvas>
        <script type="application/javascript" src="fwge.js"></script>
        <script type="application/javascript">
		let send = (function()
		{
			function Send(request)
			{
				let xml = new XMLHttpRequest();

				xml.open("POST", "/", false);
				xml.setRequestHeader("Content-type", "application/json");
				xml.send(JSON.stringify(request));

				return JSON.parse(xml.responseText);
			}
			return Send;
		})();

		let object = undefined;

		function movable_cube()
		{
			if (Input.MouseLeftDown)
			{
				let x = Input.MouseDeltaY * Time.Delta;
				let y = Input.MouseDeltaX * Time.Delta;

				this.Transform.Rotation.X = Maths.Clamp(this.Transform.Rotation.X - x, -90, 90);
				this.Transform.Rotation.Y = Maths.Clamp(this.Transform.Rotation.Y - y, -90, 90);
			}
		}

		window.onload = function onload(e)
		{
			try
			{
				FWGE.Init(
				{
					canvas:	document.getElementById("canvas"),
					clear:	[0, 0, 0, 0]
				});

				let texture = send({type: "SHADER", name: "texture"});	
				let shader = new Shader(
				{
					name: 			"Texture Shader",
					vertexshader: 	texture.vertexshader,
					fragmentshader:	texture.fragmentshader
				});

				let mesh = new Mesh(
				{
					name: 		"Cube Mesh",
					position: 	[-0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,0.5,0.5,0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5],
					normal: 	[0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0],
					colour: 	[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0],
					uv:			[0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0],
					index: 		[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],
					wireframe: 	[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,8,9,9,10,10,11,11,8,12,13,13,14,14,15,15,12,16,17,17,18,18,19,19,16,20,21,21,22,22,23,23,20]
				});

				let material = new RenderMaterial(
				{
					name: 		"Cube Material",
					ambient: 	[0.00, 0.00, 0.00, 1.00],
					diffuse: 	[0.50, 0.50, 0.50, 1.00],
					specular: 	[0.75, 0.75, 0.75, 1.00],
					alpha: 		1.00,
					shininess: 	5.00,
					shader: 	shader
				});

				let floor = new GameObject(
				{
					name: 		"Floor",
					mesh:		mesh,
					material:	material,
					transform: 	new Transform(
					{
						position:	 	[0,-1,0],
						scale: 			[10,0.01,10]
					})
				});


				/*let me = new GameObject(
				{
					name: 		"Me",
					mesh:		mesh,
					material:	new RenderMaterial(
					{
						texture:
						{
							imagemap: "me.jpg"
						},
						shader: shader
					}),
					transform: 	new Transform(
					{
						position:	 	[-2, 1, -4],
					}),
					update: movable_cube,
					physics: new PhysicsItem(
					{
						body:
						{
							locky: true
						}	
					})
				});*/

				let rabbit = new GameObject(
				{
					name: 		"Rabbit",
					mesh:		mesh,
					material:	new RenderMaterial(
					{
						texture:
						{
							imagemap: "retrorabbit.png"
						},
						shader: shader
					}),
					transform: 	new Transform(
					{
						position:	 	[2, 1, -4],
					}),
					update: movable_cube
				});

				//console.log(floor);

				/*object = OBJConverter.Parse("Cube.obj", "Cube.mtl");
				object.Material.Shader = shader;
				object.Transform.Position.Z = -4;
				object.Update = function Update()
				{
					if (Input.MouseLeftDown)
					{
						let y = Input.MouseDeltaX * Time.Delta;
						let x = Input.MouseDeltaY * Time.Delta;

						this.Transform.Rotation.Y = Maths.Clamp(this.Transform.Rotation.Y - y, -90, 90);
						this.Transform.Rotation.X = Maths.Clamp(this.Transform.Rotation.X - x, -90, 90);
					}
				};
				object.Mesh = mesh;
				object.Material = material;*/

				//let a = new AmbientLight(); console.log(a);

				//let directional = new DirectionalLight({ colour: [1, 1, 1, 1], intensity: 1.0, direction: [0, 0, 1] });

				let point = new PointLight({ position: new Vector3(0,1,-4) });

				new GameObject().Update = function()
				{
					if ((Input.KeyCtrlDown && Input.KeyRPress) || Input.KeyF5Press)
						window.location.reload();
				};
				FWGE.Start();
			}
			catch (e)
			{
				console.log(e);
			}
		};
		</script>
        <!--script type="application/javascript" src="test.js"></script-->
	</body>
</html>